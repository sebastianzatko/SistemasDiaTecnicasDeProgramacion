CREATE TABLE [dbo].[CLIENTE](
	[ID_CLIENTE] [int] IDENTITY(1,1) NOT NULL,
	[NOMBRE] [varchar](50) NOT NULL,
	[APELLIDO] [varchar](50) NOT NULL,
	[EMAIL] [varchar](70) NOT NULL,
	[TIPO] [varchar](25) NOT NULL,
	[HABILITADO] [char](1) NOT NULL,
 CONSTRAINT [PK__CLIENTE__23A34130C8D88052] PRIMARY KEY CLUSTERED 
(
	[ID_CLIENTE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[DETALLE]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DETALLE](
	[ID_VENTA] [int] NOT NULL,
	[ID_PRODUCTO] [int] NOT NULL,
	[CANTIDAD] [int] NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID_VENTA] ASC,
	[ID_PRODUCTO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DETALLEORDENCOMPRA]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DETALLEORDENCOMPRA](
	[ID_ORDENCOMPRA] [int] NOT NULL,
	[ID_PRODUCTO] [int] NOT NULL,
	[CANTIDAD] [int] NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID_ORDENCOMPRA] ASC,
	[ID_PRODUCTO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[ORDENCOMPRA]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ORDENCOMPRA](
	[ID_ORDENCOMPRA] [int] NOT NULL,
	[ID_PROVEDOR] [int] NOT NULL,
	[TIPO] [varchar](15) NOT NULL,
	[FECHA] [datetime] NOT NULL,
 CONSTRAINT [PK__ORDENCOM__0DD24B009B154610] PRIMARY KEY CLUSTERED 
(
	[ID_ORDENCOMPRA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[PRODUCTO]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PRODUCTO](
	[ID_PRODUCTO] [int] IDENTITY(1,1) NOT NULL,
	[NOMBRE] [varchar](50) NOT NULL,
	[DISPONIBILIDAD] [int] NOT NULL,
	[PRECIO] [decimal](18, 0) NULL,
	[TIPO] [char](30) NOT NULL,
	[HABILITADO] [char](1) NOT NULL,
	[COD_PRODUCTO] [nvarchar](10) NULL,
 CONSTRAINT [PK__PRODUCTO__88BD0357C832461A] PRIMARY KEY CLUSTERED 
(
	[ID_PRODUCTO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[PROVEDOR]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PROVEDOR](
	[ID_PROVEDOR] [int] IDENTITY(1,1) NOT NULL,
	[NOMBRE] [varchar](50) NOT NULL,
	[TELEFONO] [varchar](20) NOT NULL,
	[DIRECCION] [varchar](100) NOT NULL,
	[EMAIL] [varchar](100) NOT NULL,
	[HABILITADO] [char](1) NOT NULL,
 CONSTRAINT [PK__PROVEDOR__0A297F5265DE3ED7] PRIMARY KEY CLUSTERED 
(
	[ID_PROVEDOR] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[PROVEE]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PROVEE](
	[ID_PROVEDOR] [int] NOT NULL,
	[ID_PRODUCTO] [int] NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID_PROVEDOR] ASC,
	[ID_PRODUCTO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[USUARIO]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[USUARIO](
	[ID_USUARIO] [int] IDENTITY(1,1) NOT NULL,
	[DNI] [bigint] NOT NULL,
	[PASSWORD] [varchar](100) NOT NULL,
	[CARGO] [varchar](45) NOT NULL,
	[NOMBRE] [varchar](50) NOT NULL,
	[APELLIDO] [char](50) NOT NULL,
	[HABILITADO] [char](1) NOT NULL,
 CONSTRAINT [PK__USUARIO__91136B90F0AD4454] PRIMARY KEY CLUSTERED 
(
	[ID_USUARIO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[VENTA]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VENTA](
	[ID_VENTA] [int] IDENTITY(1,1) NOT NULL,
	[ID_USUARIO] [int] NOT NULL,
	[ID_CLIENTE] [int] NOT NULL,
	[FECHA] [date] NOT NULL,
 CONSTRAINT [PK__VENTA__F3B6C1B4268DF58D] PRIMARY KEY CLUSTERED 
(
	[ID_VENTA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
ALTER TABLE [dbo].[DETALLE]  WITH CHECK ADD  CONSTRAINT [FK__DETALLE__ID_PROD__1FCDBCEB] FOREIGN KEY([ID_PRODUCTO])
REFERENCES [dbo].[PRODUCTO] ([ID_PRODUCTO])
GO
ALTER TABLE [dbo].[DETALLE] CHECK CONSTRAINT [FK__DETALLE__ID_PROD__1FCDBCEB]
GO
ALTER TABLE [dbo].[DETALLE]  WITH CHECK ADD  CONSTRAINT [FK__DETALLE__ID_VENT__1ED998B2] FOREIGN KEY([ID_VENTA])
REFERENCES [dbo].[VENTA] ([ID_VENTA])
GO
ALTER TABLE [dbo].[DETALLE] CHECK CONSTRAINT [FK__DETALLE__ID_VENT__1ED998B2]
GO
ALTER TABLE [dbo].[DETALLEORDENCOMPRA]  WITH CHECK ADD  CONSTRAINT [FK__DETALLEOR__ID_OR__267ABA7A] FOREIGN KEY([ID_ORDENCOMPRA])
REFERENCES [dbo].[ORDENCOMPRA] ([ID_ORDENCOMPRA])
GO
ALTER TABLE [dbo].[DETALLEORDENCOMPRA] CHECK CONSTRAINT [FK__DETALLEOR__ID_OR__267ABA7A]
GO
ALTER TABLE [dbo].[DETALLEORDENCOMPRA]  WITH CHECK ADD  CONSTRAINT [FK__DETALLEOR__ID_PR__276EDEB3] FOREIGN KEY([ID_PRODUCTO])
REFERENCES [dbo].[PRODUCTO] ([ID_PRODUCTO])
GO
ALTER TABLE [dbo].[DETALLEORDENCOMPRA] CHECK CONSTRAINT [FK__DETALLEOR__ID_PR__276EDEB3]
GO
ALTER TABLE [dbo].[ORDENCOMPRA]  WITH CHECK ADD  CONSTRAINT [FK__ORDENCOMP__ID_PR__1BFD2C07] FOREIGN KEY([ID_PROVEDOR])
REFERENCES [dbo].[PROVEDOR] ([ID_PROVEDOR])
GO
ALTER TABLE [dbo].[ORDENCOMPRA] CHECK CONSTRAINT [FK__ORDENCOMP__ID_PR__1BFD2C07]
GO
ALTER TABLE [dbo].[PROVEE]  WITH CHECK ADD  CONSTRAINT [FK__PROVEE__ID_PRODU__239E4DCF] FOREIGN KEY([ID_PRODUCTO])
REFERENCES [dbo].[PRODUCTO] ([ID_PRODUCTO])
GO
ALTER TABLE [dbo].[PROVEE] CHECK CONSTRAINT [FK__PROVEE__ID_PRODU__239E4DCF]
GO
ALTER TABLE [dbo].[PROVEE]  WITH CHECK ADD  CONSTRAINT [FK__PROVEE__ID_PROVE__22AA2996] FOREIGN KEY([ID_PROVEDOR])
REFERENCES [dbo].[PROVEDOR] ([ID_PROVEDOR])
GO
ALTER TABLE [dbo].[PROVEE] CHECK CONSTRAINT [FK__PROVEE__ID_PROVE__22AA2996]
GO
ALTER TABLE [dbo].[VENTA]  WITH CHECK ADD  CONSTRAINT [FK__VENTA__ID_CLIENT__1920BF5C] FOREIGN KEY([ID_CLIENTE])
REFERENCES [dbo].[CLIENTE] ([ID_CLIENTE])
GO
ALTER TABLE [dbo].[VENTA] CHECK CONSTRAINT [FK__VENTA__ID_CLIENT__1920BF5C]
GO
ALTER TABLE [dbo].[VENTA]  WITH CHECK ADD  CONSTRAINT [FK__VENTA__ID_USUARI__182C9B23] FOREIGN KEY([ID_USUARIO])
REFERENCES [dbo].[USUARIO] ([ID_USUARIO])
GO
ALTER TABLE [dbo].[VENTA] CHECK CONSTRAINT [FK__VENTA__ID_USUARI__182C9B23]
GO
/****** Object:  StoredProcedure [dbo].[CARGAPRODUCTO]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[CARGAPRODUCTO]

@NOMBRE VARCHAR(50), @DISPONIBILIDAD INT, @PRECIO decimal, @TIPO CHAR(30), @COD_PRODUCTO VARCHAR(10)

AS
BEGIN 

INSERT INTO PRODUCTO (NOMBRE, DISPONIBILIDAD, PRECIO, TIPO, HABILITADO, COD_PRODUCTO)
 
 VALUES (@NOMBRE, @DISPONIBILIDAD, @PRECIO, @TIPO, 1, @COD_PRODUCTO)
 
 END

GO
/****** Object:  StoredProcedure [dbo].[CARGARPROVEEDOR]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create procedure [dbo].[CARGARPROVEEDOR] 

@NOMBRE VARCHAR (50), @TELEFONO VARCHAR (20), @DIRECCION VARCHAR(100), @EMAIL VARCHAR(100)

AS
BEGIN

INSERT INTO PROVEDOR (NOMBRE, TELEFONO, DIRECCION, EMAIL, HABILITADO)

VALUES (@NOMBRE, @TELEFONO, @DIRECCION, @EMAIL, 1)

END



GO
/****** Object:  StoredProcedure [dbo].[CREAR_CLIENTE]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create procedure [dbo].[CREAR_CLIENTE]

@NOMBRE NVARCHAR(50),@APELLIDO NVARCHAR(50),@EMAIL VARCHAR(50),@TIPO VARCHAR(50)

AS


BEGIN

INSERT INTO CLIENTE(NOMBRE,APELLIDO,EMAIL,TIPO,HABILITADO) VALUES(@NOMBRE,@APELLIDO,@EMAIL,@TIPO,1)

END

GO
/****** Object:  StoredProcedure [dbo].[DETALLEVENTA]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DETALLEVENTA]

@ID_VENTA INT,@ID_PRODUCTO INT,@CANTIDAD INT

AS

BEGIN

INSERT INTO DETALLE(ID_VENTA,ID_PRODUCTO,CANTIDAD) VALUES (@ID_VENTA,@ID_PRODUCTO,@CANTIDAD)
END

GO
/****** Object:  StoredProcedure [dbo].[ELIMINAR_CLIENTE]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ELIMINAR_CLIENTE] @ID_CLIENTE int
as
BEGIN
UPDATE CLIENTE SET HABILITADO='0' WHERE ID_CLIENTE=@ID_CLIENTE
END

GO
/****** Object:  StoredProcedure [dbo].[ELIMINAR_PROVEEDOR]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ELIMINAR_PROVEEDOR] @id_proveedor int
AS
BEGIN
UPDATE PROVEDOR SET HABILITADO=0 WHERE ID_PROVEDOR=@id_proveedor
END


GO
/****** Object:  StoredProcedure [dbo].[ELIMINARPRODUCTO]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[ELIMINARPRODUCTO]

@COD_PRODUCTO nvarchar(50) 

AS
BEGIN

UPDATE PRODUCTO SET HABILITADO=0 WHERE COD_PRODUCTO = @COD_PRODUCTO

END

GO
/****** Object:  StoredProcedure [dbo].[MODIFICAR_CLIENTE]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MODIFICAR_CLIENTE]

@ID_CLIENTE INT,@NOMBRE NVARCHAR(50),@APELLIDO NVARCHAR(50),@EMAIL VARCHAR(50),@TIPO VARCHAR(50)

AS

BEGIN

UPDATE CLIENTE SET NOMBRE=@NOMBRE,APELLIDO=@APELLIDO,EMAIL=@EMAIL,TIPO=@TIPO

WHERE ID_CLIENTE=@ID_CLIENTE
END

GO
/****** Object:  StoredProcedure [dbo].[MODIFICAR_PROVEEDOR]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[MODIFICAR_PROVEEDOR] @ID_PROVEEDOR int,@NOMBRE VARCHAR(50),@TELEFONO VARCHAR(20),@DIRECCION VARCHAR(100),@EMAIL VARCHAR(100)
AS
BEGIN
UPDATE PROVEDOR SET NOMBRE=@NOMBRE,TELEFONO=@TELEFONO,DIRECCION=@DIRECCION,EMAIL=@EMAIL WHERE ID_PROVEDOR=@ID_PROVEEDOR
END

GO
/****** Object:  StoredProcedure [dbo].[MODIFICAR_USUARIO]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create procedure [dbo].[MODIFICAR_USUARIO]
@dni bigint,@contra varchar(100),@cargo varchar(45),@nombre varchar(50),@apellido varchar(50)
AS


BEGIN

UPDATE USUARIO SET PASSWORD=ENCRYPTBYPASSPHRASE('password',@contra),CARGO=@cargo,NOMBRE=@nombre,APELLIDO=@apellido

WHERE DNI=@dni

END

GO
/****** Object:  StoredProcedure [dbo].[MODIFICARPRODUCTO]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[MODIFICARPRODUCTO]

@COD_PRODUCTO nvarchar(50) ,@NOMBRE VARCHAR(50), @DISPONIBILIDAD INT, @PRECIO decimal, @TIPO CHAR(30)

AS
BEGIN

UPDATE PRODUCTO SET NOMBRE = @NOMBRE, DISPONIBILIDAD =DISPONIBILIDAD + @DISPONIBILIDAD, PRECIO = @PRECIO, TIPO = @TIPO, COD_PRODUCTO =@COD_PRODUCTO

WHERE

COD_PRODUCTO = @COD_PRODUCTO

END

GO
/****** Object:  StoredProcedure [dbo].[REGISTRARUSUARIO]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create procedure [dbo].[REGISTRARUSUARIO]
@dni bigint,@contra varchar(100),@cargo varchar(45),@nombre varchar(50),@apellido varchar(50)

AS

BEGIN

INSERT INTO USUARIO (DNI,PASSWORD,CARGO,NOMBRE,APELLIDO,HABILITADO) VALUES (@dni,ENCRYPTBYPASSPHRASE('password',@contra),@cargo,@nombre,@apellido,1)

END

GO
/****** Object:  StoredProcedure [dbo].[VENTAS]    Script Date: 02/07/2018 1:45:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create procedure [dbo].[VENTAS]

@ID_USUARIO INT ,@ID_CLIENTE INT,@FECHA DATE


AS

BEGIN

INSERT INTO VENTA(ID_USUARIO,ID_CLIENTE,FECHA) VALUES(@ID_USUARIO,@ID_CLIENTE,@FECHA)

END

GO
USE [master]
GO
ALTER DATABASE [sistemadia] SET  READ_WRITE 
GO